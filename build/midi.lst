ARM GAS  /tmp/ccqrihRf.s 			page 1


   1              		.syntax unified
   2              		.cpu cortex-m4
   3              		.eabi_attribute 27, 1
   4              		.fpu fpv4-sp-d16
   5              		.eabi_attribute 20, 1
   6              		.eabi_attribute 21, 1
   7              		.eabi_attribute 23, 3
   8              		.eabi_attribute 24, 1
   9              		.eabi_attribute 25, 1
  10              		.eabi_attribute 26, 1
  11              		.eabi_attribute 30, 6
  12              		.eabi_attribute 34, 1
  13              		.eabi_attribute 18, 4
  14              		.thumb
  15              		.syntax unified
  16              		.file	"midi.c"
  17              		.text
  18              	.Ltext0:
  19              		.cfi_sections	.debug_frame
  20              		.comm	midiMessagebuffer,4,4
  21              		.section	.text.midi_init,"ax",%progbits
  22              		.align	2
  23              		.global	midi_init
  24              		.thumb
  25              		.thumb_func
  27              	midi_init:
  28              	.LFB112:
  29              		.file 1 "Src/midi.c"
   1:Src/midi.c    **** /*
   2:Src/midi.c    ****  * midi.c
   3:Src/midi.c    ****  *
   4:Src/midi.c    ****  *  Created on: 19.05.2015
   5:Src/midi.c    ****  *      Author: raphael
   6:Src/midi.c    ****  */
   7:Src/midi.c    **** 
   8:Src/midi.c    **** #include "midi.h"
   9:Src/midi.c    **** #include "stm32f3xx_hal.h"
  10:Src/midi.c    **** #include "stm32f3xx.h"
  11:Src/midi.c    **** #include "string.h"
  12:Src/midi.c    **** #include "stdlib.h"
  13:Src/midi.c    **** 
  14:Src/midi.c    **** extern UART_HandleTypeDef huart3;
  15:Src/midi.c    **** 
  16:Src/midi.c    **** void midi_init(){
  30              		.loc 1 16 0
  31              		.cfi_startproc
  32              		@ args = 0, pretend = 0, frame = 0
  33              		@ frame_needed = 1, uses_anonymous_args = 0
  34 0000 80B5     		push	{r7, lr}
  35              	.LCFI0:
  36              		.cfi_def_cfa_offset 8
  37              		.cfi_offset 7, -8
  38              		.cfi_offset 14, -4
  39 0002 00AF     		add	r7, sp, #0
  40              	.LCFI1:
  41              		.cfi_def_cfa_register 7
  17:Src/midi.c    **** 	midiMessagebuffer = uartmessagebuffer_create(MIDI_TXMESSAGEBUFFERSIZE,MIDI_TXBUFFERSIZE, &huart3);
ARM GAS  /tmp/ccqrihRf.s 			page 2


  42              		.loc 1 17 0
  43 0004 044A     		ldr	r2, .L2
  44 0006 0A21     		movs	r1, #10
  45 0008 0A20     		movs	r0, #10
  46 000a FFF7FEFF 		bl	uartmessagebuffer_create
  47 000e 0246     		mov	r2, r0
  48 0010 024B     		ldr	r3, .L2+4
  49 0012 1A60     		str	r2, [r3]
  18:Src/midi.c    **** }
  50              		.loc 1 18 0
  51 0014 00BF     		nop
  52 0016 80BD     		pop	{r7, pc}
  53              	.L3:
  54              		.align	2
  55              	.L2:
  56 0018 00000000 		.word	huart3
  57 001c 00000000 		.word	midiMessagebuffer
  58              		.cfi_endproc
  59              	.LFE112:
  61              		.section	.text.midi_sendNote,"ax",%progbits
  62              		.align	2
  63              		.global	midi_sendNote
  64              		.thumb
  65              		.thumb_func
  67              	midi_sendNote:
  68              	.LFB113:
  19:Src/midi.c    **** 
  20:Src/midi.c    **** void midi_sendNote(uint8_t channel, uint8_t note, uint8_t velocity){
  69              		.loc 1 20 0
  70              		.cfi_startproc
  71              		@ args = 0, pretend = 0, frame = 16
  72              		@ frame_needed = 1, uses_anonymous_args = 0
  73 0000 80B5     		push	{r7, lr}
  74              	.LCFI2:
  75              		.cfi_def_cfa_offset 8
  76              		.cfi_offset 7, -8
  77              		.cfi_offset 14, -4
  78 0002 84B0     		sub	sp, sp, #16
  79              	.LCFI3:
  80              		.cfi_def_cfa_offset 24
  81 0004 00AF     		add	r7, sp, #0
  82              	.LCFI4:
  83              		.cfi_def_cfa_register 7
  84 0006 0346     		mov	r3, r0
  85 0008 FB71     		strb	r3, [r7, #7]
  86 000a 0B46     		mov	r3, r1
  87 000c BB71     		strb	r3, [r7, #6]
  88 000e 1346     		mov	r3, r2
  89 0010 7B71     		strb	r3, [r7, #5]
  21:Src/midi.c    **** 
  22:Src/midi.c    **** 
  23:Src/midi.c    **** 	//note on
  24:Src/midi.c    **** 	uint8_t bfrsize = 6;
  90              		.loc 1 24 0
  91 0012 0623     		movs	r3, #6
  92 0014 FB73     		strb	r3, [r7, #15]
  25:Src/midi.c    **** 	uint8_t* bfr = malloc(sizeof(uint8_t)*bfrsize);
ARM GAS  /tmp/ccqrihRf.s 			page 3


  93              		.loc 1 25 0
  94 0016 FB7B     		ldrb	r3, [r7, #15]	@ zero_extendqisi2
  95 0018 1846     		mov	r0, r3
  96 001a FFF7FEFF 		bl	malloc
  97 001e 0346     		mov	r3, r0
  98 0020 BB60     		str	r3, [r7, #8]
  26:Src/midi.c    **** 
  27:Src/midi.c    **** 	bfr[0] = 0xFF & ( 0x90 | channel  & 0xF);
  99              		.loc 1 27 0
 100 0022 FB79     		ldrb	r3, [r7, #7]	@ zero_extendqisi2
 101 0024 03F00F03 		and	r3, r3, #15
 102 0028 DBB2     		uxtb	r3, r3
 103 002a 63F06F03 		orn	r3, r3, #111
 104 002e DBB2     		uxtb	r3, r3
 105 0030 DAB2     		uxtb	r2, r3
 106 0032 BB68     		ldr	r3, [r7, #8]
 107 0034 1A70     		strb	r2, [r3]
  28:Src/midi.c    **** 	bfr[1] = note & 0x7F;
 108              		.loc 1 28 0
 109 0036 BB68     		ldr	r3, [r7, #8]
 110 0038 0133     		adds	r3, r3, #1
 111 003a BA79     		ldrb	r2, [r7, #6]
 112 003c 02F07F02 		and	r2, r2, #127
 113 0040 D2B2     		uxtb	r2, r2
 114 0042 1A70     		strb	r2, [r3]
  29:Src/midi.c    **** 	bfr[2] = velocity & 0x7F;
 115              		.loc 1 29 0
 116 0044 BB68     		ldr	r3, [r7, #8]
 117 0046 0233     		adds	r3, r3, #2
 118 0048 7A79     		ldrb	r2, [r7, #5]
 119 004a 02F07F02 		and	r2, r2, #127
 120 004e D2B2     		uxtb	r2, r2
 121 0050 1A70     		strb	r2, [r3]
  30:Src/midi.c    **** 
  31:Src/midi.c    **** 	//note off
  32:Src/midi.c    **** 	bfr[3] = 0xFF & ( 0x80 | channel  & 0xF);
 122              		.loc 1 32 0
 123 0052 BB68     		ldr	r3, [r7, #8]
 124 0054 0333     		adds	r3, r3, #3
 125 0056 FA79     		ldrb	r2, [r7, #7]	@ zero_extendqisi2
 126 0058 02F00F02 		and	r2, r2, #15
 127 005c D2B2     		uxtb	r2, r2
 128 005e 62F07F02 		orn	r2, r2, #127
 129 0062 D2B2     		uxtb	r2, r2
 130 0064 D2B2     		uxtb	r2, r2
 131 0066 1A70     		strb	r2, [r3]
  33:Src/midi.c    **** 	bfr[4] = note & 0x7F;
 132              		.loc 1 33 0
 133 0068 BB68     		ldr	r3, [r7, #8]
 134 006a 0433     		adds	r3, r3, #4
 135 006c BA79     		ldrb	r2, [r7, #6]
 136 006e 02F07F02 		and	r2, r2, #127
 137 0072 D2B2     		uxtb	r2, r2
 138 0074 1A70     		strb	r2, [r3]
  34:Src/midi.c    **** 	bfr[5] = velocity & 0x7F;
 139              		.loc 1 34 0
 140 0076 BB68     		ldr	r3, [r7, #8]
ARM GAS  /tmp/ccqrihRf.s 			page 4


 141 0078 0533     		adds	r3, r3, #5
 142 007a 7A79     		ldrb	r2, [r7, #5]
 143 007c 02F07F02 		and	r2, r2, #127
 144 0080 D2B2     		uxtb	r2, r2
 145 0082 1A70     		strb	r2, [r3]
  35:Src/midi.c    **** 
  36:Src/midi.c    **** 	uartmessagebuffer_createmessage(midiMessagebuffer, bfrsize, bfr);
 146              		.loc 1 36 0
 147 0084 054B     		ldr	r3, .L5
 148 0086 1B68     		ldr	r3, [r3]
 149 0088 F97B     		ldrb	r1, [r7, #15]	@ zero_extendqisi2
 150 008a BA68     		ldr	r2, [r7, #8]
 151 008c 1846     		mov	r0, r3
 152 008e FFF7FEFF 		bl	uartmessagebuffer_createmessage
  37:Src/midi.c    **** 
  38:Src/midi.c    **** 
  39:Src/midi.c    **** }
 153              		.loc 1 39 0
 154 0092 00BF     		nop
 155 0094 1037     		adds	r7, r7, #16
 156              	.LCFI5:
 157              		.cfi_def_cfa_offset 8
 158 0096 BD46     		mov	sp, r7
 159              	.LCFI6:
 160              		.cfi_def_cfa_register 13
 161              		@ sp needed
 162 0098 80BD     		pop	{r7, pc}
 163              	.L6:
 164 009a 00BF     		.align	2
 165              	.L5:
 166 009c 00000000 		.word	midiMessagebuffer
 167              		.cfi_endproc
 168              	.LFE113:
 170              		.section	.text.midi_sendControlChange,"ax",%progbits
 171              		.align	2
 172              		.global	midi_sendControlChange
 173              		.thumb
 174              		.thumb_func
 176              	midi_sendControlChange:
 177              	.LFB114:
  40:Src/midi.c    **** 
  41:Src/midi.c    **** void midi_sendControlChange(uint8_t channel, uint8_t control, uint8_t value){
 178              		.loc 1 41 0
 179              		.cfi_startproc
 180              		@ args = 0, pretend = 0, frame = 16
 181              		@ frame_needed = 1, uses_anonymous_args = 0
 182 0000 80B5     		push	{r7, lr}
 183              	.LCFI7:
 184              		.cfi_def_cfa_offset 8
 185              		.cfi_offset 7, -8
 186              		.cfi_offset 14, -4
 187 0002 84B0     		sub	sp, sp, #16
 188              	.LCFI8:
 189              		.cfi_def_cfa_offset 24
 190 0004 00AF     		add	r7, sp, #0
 191              	.LCFI9:
 192              		.cfi_def_cfa_register 7
ARM GAS  /tmp/ccqrihRf.s 			page 5


 193 0006 0346     		mov	r3, r0
 194 0008 FB71     		strb	r3, [r7, #7]
 195 000a 0B46     		mov	r3, r1
 196 000c BB71     		strb	r3, [r7, #6]
 197 000e 1346     		mov	r3, r2
 198 0010 7B71     		strb	r3, [r7, #5]
  42:Src/midi.c    **** 
  43:Src/midi.c    **** 	uint8_t bfrsize = 3;
 199              		.loc 1 43 0
 200 0012 0323     		movs	r3, #3
 201 0014 FB73     		strb	r3, [r7, #15]
  44:Src/midi.c    **** 	uint8_t* bfr = malloc(sizeof(uint8_t)*bfrsize);
 202              		.loc 1 44 0
 203 0016 FB7B     		ldrb	r3, [r7, #15]	@ zero_extendqisi2
 204 0018 1846     		mov	r0, r3
 205 001a FFF7FEFF 		bl	malloc
 206 001e 0346     		mov	r3, r0
 207 0020 BB60     		str	r3, [r7, #8]
  45:Src/midi.c    **** 
  46:Src/midi.c    **** 	bfr[0] = 0xFF & ( 0b10110000 | channel & 0xF);
 208              		.loc 1 46 0
 209 0022 FB79     		ldrb	r3, [r7, #7]	@ zero_extendqisi2
 210 0024 03F00F03 		and	r3, r3, #15
 211 0028 DBB2     		uxtb	r3, r3
 212 002a 63F04F03 		orn	r3, r3, #79
 213 002e DBB2     		uxtb	r3, r3
 214 0030 DAB2     		uxtb	r2, r3
 215 0032 BB68     		ldr	r3, [r7, #8]
 216 0034 1A70     		strb	r2, [r3]
  47:Src/midi.c    **** 	bfr[1] = control & 0x7F;
 217              		.loc 1 47 0
 218 0036 BB68     		ldr	r3, [r7, #8]
 219 0038 0133     		adds	r3, r3, #1
 220 003a BA79     		ldrb	r2, [r7, #6]
 221 003c 02F07F02 		and	r2, r2, #127
 222 0040 D2B2     		uxtb	r2, r2
 223 0042 1A70     		strb	r2, [r3]
  48:Src/midi.c    **** 	bfr[2] = value & 0x7F;
 224              		.loc 1 48 0
 225 0044 BB68     		ldr	r3, [r7, #8]
 226 0046 0233     		adds	r3, r3, #2
 227 0048 7A79     		ldrb	r2, [r7, #5]
 228 004a 02F07F02 		and	r2, r2, #127
 229 004e D2B2     		uxtb	r2, r2
 230 0050 1A70     		strb	r2, [r3]
  49:Src/midi.c    **** 
  50:Src/midi.c    **** 	//uartmessagebuffer_createmessage(midiMessagebuffer, bfrsize, bfr);
  51:Src/midi.c    **** 
  52:Src/midi.c    **** }
 231              		.loc 1 52 0
 232 0052 00BF     		nop
 233 0054 1037     		adds	r7, r7, #16
 234              	.LCFI10:
 235              		.cfi_def_cfa_offset 8
 236 0056 BD46     		mov	sp, r7
 237              	.LCFI11:
 238              		.cfi_def_cfa_register 13
ARM GAS  /tmp/ccqrihRf.s 			page 6


 239              		@ sp needed
 240 0058 80BD     		pop	{r7, pc}
 241              		.cfi_endproc
 242              	.LFE114:
 244 005a 00BF     		.text
 245              	.Letext0:
 246              		.file 2 "/usr/arm-none-eabi/include/machine/_default_types.h"
 247              		.file 3 "/usr/arm-none-eabi/include/sys/_stdint.h"
 248              		.file 4 "Drivers/CMSIS/Device/ST/STM32F3xx/Include/stm32f303xc.h"
 249              		.file 5 "Drivers/STM32F3xx_HAL_Driver/Inc/stm32f3xx_hal_def.h"
 250              		.file 6 "Drivers/STM32F3xx_HAL_Driver/Inc/stm32f3xx_hal_dma.h"
 251              		.file 7 "Drivers/STM32F3xx_HAL_Driver/Inc/stm32f3xx_hal_uart.h"
 252              		.file 8 "Inc/uartmessagebuffer.h"
 253              		.file 9 "Drivers/CMSIS/Include/core_cm4.h"
 254              		.file 10 "Inc/midi.h"
ARM GAS  /tmp/ccqrihRf.s 			page 7


DEFINED SYMBOLS
                            *ABS*:0000000000000000 midi.c
                            *COM*:0000000000000004 midiMessagebuffer
     /tmp/ccqrihRf.s:22     .text.midi_init:0000000000000000 $t
     /tmp/ccqrihRf.s:27     .text.midi_init:0000000000000000 midi_init
     /tmp/ccqrihRf.s:56     .text.midi_init:0000000000000018 $d
     /tmp/ccqrihRf.s:62     .text.midi_sendNote:0000000000000000 $t
     /tmp/ccqrihRf.s:67     .text.midi_sendNote:0000000000000000 midi_sendNote
     /tmp/ccqrihRf.s:166    .text.midi_sendNote:000000000000009c $d
     /tmp/ccqrihRf.s:171    .text.midi_sendControlChange:0000000000000000 $t
     /tmp/ccqrihRf.s:176    .text.midi_sendControlChange:0000000000000000 midi_sendControlChange
                     .debug_frame:0000000000000010 $d

UNDEFINED SYMBOLS
uartmessagebuffer_create
huart3
malloc
uartmessagebuffer_createmessage
